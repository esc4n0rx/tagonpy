<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title or "TagonPy" }}</title>
    
    <!-- Tailwind CSS -->
    {% if assets and assets.tailwind_css %}
    <style>
        /* Tailwind CSS compilado */
        {{ assets.tailwind_css | safe }}
    </style>
    {% else %}
    <!-- Fallback: Tailwind via CDN para desenvolvimento inicial -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tagonpy': {
                            50: '#f0f9ff',
                            500: '#3b82f6',
                            900: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>
    {% endif %}
    
    <!-- CSS do componente (fallback) -->
    {% if component_css %}
    <style>
        /* CSS do componente */
        {{ component_css | safe }}
    </style>
    {% endif %}
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <!-- Notifica√ß√£o de status do Tailwind -->
    <div id="tailwind-status" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg text-sm">
            üé® Tailwind CSS ativo
        </div>
    </div>
    
    {{ content | safe }}
    
    <!-- Live Reload Script com suporte a Tailwind -->
    <script>
        console.log('üîó Iniciando TagonPy Live Reload com Tailwind...');
        
        let ws;
        let reconnectInterval = 1000;
        let maxReconnectInterval = 5000;
        let reconnectAttempts = 0;
        
        function connect() {
            try {
                ws = new WebSocket('ws://localhost:3000/ws');
                
                ws.onopen = function() {
                    console.log('‚úÖ Live reload conectado');
                    reconnectAttempts = 0;
                    reconnectInterval = 1000;
                    showConnectionStatus('connected');
                    showTailwindStatus();
                };
                
                ws.onmessage = function(event) {
                    console.log('üì® Mensagem recebida:', event.data);
                    
                    if (event.data === 'reload') {
                        console.log('üîÑ Recarregando p√°gina...');
                        showReloadNotification();
                        setTimeout(() => {
                            location.reload();
                        }, 500);
                    } else if (event.data === 'css-updated') {
                        console.log('üé® CSS atualizado, recarregando...');
                        showCssUpdateNotification();
                        setTimeout(() => {
                            location.reload();
                        }, 300);
                    }
                };
                
                ws.onclose = function() {
                    console.log('‚ùå Conex√£o perdida. Tentando reconectar...');
                    showConnectionStatus('disconnected');
                    scheduleReconnect();
                };
                
                ws.onerror = function(error) {
                    console.error('üö® Erro no WebSocket:', error);
                    showConnectionStatus('error');
                };
                
            } catch (error) {
                console.error('üö® Erro ao conectar:', error);
                scheduleReconnect();
            }
        }
        
        function scheduleReconnect() {
            reconnectAttempts++;
            console.log(`üîÑ Tentativa de reconex√£o ${reconnectAttempts} em ${reconnectInterval}ms`);
            
            setTimeout(() => {
                connect();
            }, reconnectInterval);
            
            reconnectInterval = Math.min(reconnectInterval * 1.5, maxReconnectInterval);
        }
        
        function showConnectionStatus(status) {
            const existingIndicator = document.getElementById('tagonpy-status');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            const indicator = document.createElement('div');
            indicator.id = 'tagonpy-status';
            indicator.className = 'fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg text-sm font-medium transition-all duration-300';
            
            if (status === 'connected') {
                indicator.className += ' bg-green-500 text-white';
                indicator.textContent = 'üü¢ Live Reload ON';
            } else if (status === 'disconnected') {
                indicator.className += ' bg-red-500 text-white';
                indicator.textContent = 'üî¥ Reconnecting...';
            } else {
                indicator.className += ' bg-yellow-500 text-white';
                indicator.textContent = 'üü° Connection Error';
            }
            
            document.body.appendChild(indicator);
            
            if (status === 'connected') {
                setTimeout(() => {
                    if (indicator && indicator.parentNode) {
                        indicator.style.opacity = '0';
                        setTimeout(() => {
                            if (indicator && indicator.parentNode) {
                                indicator.remove();
                            }
                        }, 300);
                    }
                }, 3000);
            }
        }
        
        function showTailwindStatus() {
            const status = document.getElementById('tailwind-status');
            if (status) {
                status.classList.remove('hidden');
                setTimeout(() => {
                    status.classList.add('hidden');
                }, 3000);
            }
        }
        
        function showReloadNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-blue-500 text-white px-6 py-4 rounded-lg shadow-xl font-medium';
            notification.innerHTML = 'üîÑ Atualizando componente...';
            
            document.body.appendChild(notification);
        }
        
        function showCssUpdateNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-purple-500 text-white px-6 py-4 rounded-lg shadow-xl font-medium';
            notification.innerHTML = 'üé® Tailwind CSS atualizado...';
            
            document.body.appendChild(notification);
        }
        
        connect();
        
        // Log do status do Tailwind
        setTimeout(() => {
            const hasTailwind = document.querySelector('style') || document.querySelector('script[src*="tailwind"]');
            if (hasTailwind) {
                console.log('‚úÖ Tailwind CSS carregado');
            } else {
                console.warn('‚ö†Ô∏è Tailwind CSS n√£o detectado');
            }
        }, 1000);
    </script>
</body>
</html>